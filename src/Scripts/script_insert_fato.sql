USE ORCAMENTO_PUBLICO;

DROP TABLE IF EXISTS DIMENSOES;

CREATE TEMPORARY TABLE DIMENSOES AS
(
	SELECT
		0 AS ID_DATA
	,	0 AS ID_AREA_ATUACAO
	,	0 AS ID_ORGAO
	,	0 AS ID_PROGRAMA
);

DELETE FROM DIMENSOES;

INSERT INTO DIMENSOES (ID_DATA)
	SELECT D.ID_DIMENSAO_DATA FROM TD_DATA AS D
		LEFT JOIN FT_DESPESAS_PUBLICAS AS DP ON D.ID_DIMENSAO_DATA = DP.ID_DIMENSAO_DATA AND D.MES = '01' AND D.ANO = '2019'
		WHERE DP.ID_FT_DESPESAS_PUBLICAS IS NULL;

INSERT INTO DIMENSOES (ID_AREA_ATUACAO)
	SELECT A.ID_DIMENSAO_AREA_ATUACAO FROM TD_AREA_ATUACAO AS A
		LEFT JOIN FT_DESPESAS_PUBLICAS AS DP ON A.ID_DIMENSAO_AREA_ATUACAO = DP.ID_DIMENSAO_AREA_ATUACAO
		WHERE DP.ID_FT_DESPESAS_PUBLICAS IS NULL;
    
    
INSERT INTO DIMENSOES (ID_ORGAO)
	SELECT O.ID_DIMENSAO_ORGAO FROM TD_ORGAO AS O
		LEFT JOIN FT_DESPESAS_PUBLICAS AS DP ON O.ID_DIMENSAO_ORGAO = DP.ID_DIMENSAO_ORGAO
		WHERE DP.ID_FT_DESPESAS_PUBLICAS IS NULL;
    
INSERT INTO DIMENSOES (ID_PROGRAMA)
	SELECT D.ID_DIMENSAO_PROGRAMA FROM TD_PROGRAMA AS D
		LEFT JOIN FT_DESPESAS_PUBLICAS AS DP ON D.ID_DIMENSAO_PROGRAMA = DP.ID_DIMENSAO_PROGRAMA
		WHERE DP.ID_FT_DESPESAS_PUBLICAS IS NULL;

INSERT INTO FT_DESPESAS_PUBLICAS
(
	VL_ORCADO
,	VL_LIQUIDADO
,	ID_DIMENSAO_PROGRAMA
,	ID_DIMENSAO_ORGAO
,	ID_DIMENSAO_AREA_ATUACAO
,	ID_DIMENSAO_DATA
)
SELECT 0.0, 0.0, D.ID_PROGRAMA, D.ID_ORGAO, D.ID_AREA_ATUACAO, D.ID_DATA FROM DIMENSOES AS D;

DROP TABLE IF EXISTS DIMENSOES;